# $Id: Portfile 118279 2014-03-28 18:08:26Z and.damore@macports.org $

PortSystem          1.0

name                luajit
version             2.0.3
categories          lang
platforms           darwin
license             BSD
maintainers         nomaintainer
description         a Just-In-Time Compiler for Lua
long_description    LuaJIT is a Just-In-Time Compiler for the Lua programming language.
homepage            http://luajit.org
master_sites        ${homepage}/download
distname            LuaJIT-${version}

checksums           rmd160  aa5c3fc367871a6ad15c7f9ad3300327c20462ec \
                    sha256  55be6cb2d101ed38acca32c5b1f99ae345904b365b642203194c585d27bebd79

use_configure       no

build.target        amalg
build.args-append   CC="${configure.cc}" \
                    CFLAGS="${configure.cppflags} ${configure.cflags} [get_canonical_archflags] -DLUAJIT_ENABLE_LUA52COMPAT" \
                    LDFLAGS="${configure.ldflags} [get_canonical_archflags]" \
                    PREFIX="${prefix}" \
                    Q=""

post-patch {
    reinplace "s|/usr/local|${prefix}|"    ${worksrcpath}/etc/luajit.pc
}

destroot.args-append   PREFIX="${prefix}"

post-destroot {
    xinstall -m 755 -d ${destroot}${prefix}/share/doc
    copy ${worksrcpath}/doc/ ${destroot}${prefix}/share/doc/${name}
}

livecheck.type  regex
livecheck.url   ${master_sites}.html
livecheck.regex {LuaJIT-(\d+(?:\.\d+)*(?:-beta\d+)?).tar.gz}
