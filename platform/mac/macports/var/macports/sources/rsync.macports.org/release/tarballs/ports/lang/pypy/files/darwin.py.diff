--- rpython/translator/platform/darwin.py.orig	2015-08-28 19:39:59.000000000 +1000
+++ rpython/translator/platform/darwin.py	2015-09-01 07:15:40.000000000 +1000
@@ -7,7 +7,7 @@
 # the @rpath handling used in Darwin._args_for_shared is only availabe
 # since 10.5, so we use that as minimum requirement.
 #
-DARWIN_VERSION_MIN = '-mmacosx-version-min=10.5'
+DARWIN_VERSION_MIN = ''
 
 class Darwin(posix.BasePosix):
     name = "darwin"
@@ -34,10 +34,10 @@
                 + args)
 
     def _include_dirs_for_libffi(self):
-        return ['/usr/include/ffi']
+        return self._pkg_config("libffi", "--cflags-only-I", ['/usr/include/ffi'])
 
     def _library_dirs_for_libffi(self):
-        return ['/usr/lib']
+        return self._pkg_config("libffi", "--libs-only-L", ['/usr/lib'])
 
     def _frameworks(self, frameworks):
         args = []
@@ -76,11 +76,15 @@
 
 class Darwin_PowerPC(Darwin):#xxx fixme, mwp
     name = "darwin_powerpc"
+    link_flags = ('-arch', 'ppc')
+    cflags = ('-arch', 'ppc', '-O3')
 
 class Darwin_i386(Darwin):
     name = "darwin_i386"
-    DEFAULT_CC = 'clang -arch i386'
+    link_flags = ('-arch', 'i386')
+    cflags = ('-arch', 'i386', '-O3', '-fomit-frame-pointer')
 
 class Darwin_x86_64(Darwin):
     name = "darwin_x86_64"
-    DEFAULT_CC = 'clang -arch x86_64'
+    link_flags = ('-arch', 'x86_64')
+    cflags = ('-arch', 'x86_64', '-O3', '-fomit-frame-pointer')
