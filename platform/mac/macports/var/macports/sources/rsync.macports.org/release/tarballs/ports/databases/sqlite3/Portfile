# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 143106 2015-12-04 06:25:59Z ryandesign@macports.org $

PortSystem          1.0

name                sqlite3
version             3.9.2
categories          databases
platforms           darwin
license             public-domain

maintainers         mww openmaintainer

description         an embedded SQL database engine

long_description    SQLite3 is an SQL database engine in a C library. \
                    Programs that link the SQLite3 library can have SQL \
                    database access without running a separate RDBMS \
                    process. The distribution comes with a standalone \
                    command-line access program (sqlite3) that can be used \
                    to administer an SQLite3 database and which serves as \
                    an example of how to use the SQLite3 library.

homepage            http://www.sqlite.org/
master_sites        ${homepage}2015

distname            sqlite-autoconf-[string range [subst [regsub -all {\.([0-9]+)} "${version}.0.0" {[format %02d \1]}]] 0 6]

checksums           rmd160  6dd6e0779b1cea20141ed4659311461e125b73bf \
                    sha256  064c0abe9c9177534d4c770bca7a5902f9924b629ac886b4c08956be6dfbc36b

depends_lib         port:libedit \
                    port:ncurses

patchfiles          patch-configure.diff

configure.args      --enable-threadsafe \
                    --enable-dynamic-extensions \
                    --enable-readline

# search in worksrcpath for sqlite3.h first -- dont pick up an installed one!
configure.cppflags-prepend  -DSQLITE_ENABLE_COLUMN_METADATA \
                            -DSQLITE_ENABLE_FTS3_PARENTHESIS \
                            -DSQLITE_ENABLE_FTS4 \
                            -DSQLITE_ENABLE_RTREE \
                            -DSQLITE_SECURE_DELETE \
                            -DSQLITE_ENABLE_STAT4 \
                            -DSQLITE_ENABLE_UNLOCK_NOTIFY \
                            -DSQLITE_SOUNDEX \
                            -I${worksrcpath}

build.type          gnu

livecheck.type      regex
livecheck.url       http://www.sqlite.org/news.html
livecheck.regex     (3(?:\\.\[0-9\]+)+)

post-destroot {
    xinstall -m 644 ${worksrcpath}/${name}.1 ${destroot}${prefix}/share/man/man1
}

platform darwin 8 {
    configure.cppflags-append -DSQLITE_WITHOUT_ZONEMALLOC
}
