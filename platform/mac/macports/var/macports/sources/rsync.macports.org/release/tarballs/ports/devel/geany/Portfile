# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 126699 2014-10-14 01:51:27Z devans@macports.org $

PortSystem      1.0

name            geany
version         1.24.1
revision        1
license         GPL-2+
categories      devel
platforms       darwin
maintainers     si-co.net:kiarash

description     A fast and lightweight GTK+ IDE

long_description \
    Geany is a small and lightweight integrated development \
    environment. It was developed to provide a small and fast \
    IDE, which has only a few dependencies from other packages. \
    Another goal was to be as independent as possible from a \
    special Desktop Environment like KDE or GNOME.

homepage        http://www.geany.org/
master_sites    http://download.geany.org/
use_bzip2       yes

checksums       rmd160  f5fd46ed83451147a95516812628a1a6b459a98c \
                sha256  7fb505d9b01fe6874890525f837644a6a38c23a372bb068c65ef3673108a8c33

depends_build \
    port:pkgconfig \
    port:intltool
depends_lib \
    port:desktop-file-utils \
    port:gettext \
    port:gtk2 \
    port:vte-gtk2-compat

# update m4/intltool.m4 and autoreconf

pre-configure {
    copy -force ${prefix}/share/aclocal/intltool.m4 ${worksrcpath}/m4
}

use_autoreconf      yes
autoreconf.args     -fvi

configure.args      --disable-silent-rules \
                    --enable-vte

platform darwin {
    patchfiles-append vte-sonames.diff

    post-patch {
        reinplace "s|@@MP_PREFIX@@|${prefix}|" ${worksrcpath}/src/vte.c
    }
}

variant gtk3 description {Enable experimental gtk3 support} {
    depends_lib-replace port:gtk2 port:gtk3
    depends_lib-replace port:vte-gtk2-compat port:vte-2.90
    configure.args-append --enable-gtk3
}

if {[variant_isset gtk3]} {
    set update_icon_cache "gtk-update-icon-cache-3.0"
} else {
    set update_icon_cache "gtk-update-icon-cache"
}

post-activate {
    system "${prefix}/bin/update-desktop-database ${prefix}/share/applications"
    system "${prefix}/bin/${update_icon_cache} -f -t ${prefix}/share/icons/hicolor"
}

livecheck.type  regex
livecheck.url   ${master_sites}
livecheck.regex "${name}-(\\d+(?:\\.\\d+)*)${extract.suffix}"
