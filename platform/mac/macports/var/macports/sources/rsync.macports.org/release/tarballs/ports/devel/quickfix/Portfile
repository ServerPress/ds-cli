# $Id: Portfile 128227 2014-11-16 23:03:51Z khindenburg@macports.org $

PortSystem          1.0
name                quickfix
version             1.14.0
license             Permissive
# http://www.quickfixengine.org/quickfix/doc/html/license.html
categories          devel finance
maintainers         nomaintainer
description         FIX engine implementation
long_description \
   QuickFIX is a full-featured open source FIX engine, currently compatible \
   with the FIX 4.0-4.4 spec.

platforms           darwin

homepage            http://www.quickfixengine.org/
master_sites        sourceforge:project/quickfix/quickfix/${version}
worksrcdir          ${name}

checksums           rmd160  99e808a79acc4cfad924831da6e073c9d1211bdf \
                    sha256  1d6906ba828c5ef909199117d992143f117831e4fdb4999f9012f575a0882d90

depends_lib         port:libxml2

patchfiles          patch-UnitTest++-Makefile.diff

variant universal {}

post-patch {
   reinplace "s|@@PREFIX@@|${prefix}|g" ${worksrcpath}/configure
   reinplace "s|@CXX@|${configure.cxx}|g" ${worksrcpath}/UnitTest++/Makefile
   reinplace "s|@ARCHFLAGS@|[get_canonical_archflags cxx]|g" ${worksrcpath}/UnitTest++/Makefile
}

configure.args      --with-java
configure.env       "JAVA_HOME=/System/Library/Frameworks/JavaVM.framework/Home"

post-destroot {
   xinstall -m 755 -d ${destroot}${prefix}/share/${name}/sql
   copy ${worksrcpath}/src/sql/postgresql ${destroot}${prefix}/share/${name}/sql
}

variant python description {Include python support} {
   depends_lib-append      port:python26
   configure.args-append   --with-python=${prefix}
   patchfiles-append       patch-python.diff
}

variant postgresql84 conflicts postgresql90 description {Include PostGreSQL 8.4 support} {
   depends_lib-append      port:postgresql84
   configure.args-append   --with-postgresql=${prefix}
   patchfiles-append       patch-postgresql84.diff
}

variant postgresql90 conflicts postgresql84 description {Include PostGreSQL 9.0 support} {
   depends_lib-append      port:postgresql90
   configure.args-append   --with-postgresql=${prefix}
   patchfiles-append       patch-postgresql90.diff
}
