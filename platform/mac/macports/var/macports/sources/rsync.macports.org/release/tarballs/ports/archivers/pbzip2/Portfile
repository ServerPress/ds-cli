# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 129872 2014-12-22 01:58:57Z ryandesign@macports.org $

PortSystem          1.0

name                pbzip2
version             1.1.12
set branch          [join [lrange [split ${version} .] 0 1] .]
categories          archivers
platforms           darwin
maintainers         ryandesign openmaintainer
license             Permissive
installs_libs       no

description         parallel bzip2

long_description    PBZIP2 is a parallel implementation of the bzip2 \
                    block-sorting file compressor that uses pthreads and \
                    achieves near-linear speedup on SMP machines.

homepage            http://compression.ca/pbzip2/
master_sites        https://launchpad.net/pbzip2/${branch}/${version}/+download/

checksums           rmd160  a0c4ce4953316b60e12d0237650b7e783e486395 \
                    sha256  573bb358a5a7d3bf5f42f881af324cedf960c786e8d66dd03d448ddd8a0166ee

depends_lib         port:bzip2

patchfiles-append   patch-Makefile.diff

use_configure       no

variant universal {}

pre-build {
    build.env-append \
                    CXX="${configure.cxx}" \
                    CXXFLAGS="${configure.cxxflags} [get_canonical_archflags cxx]" \
                    LDFLAGS="${configure.ldflags} [get_canonical_archflags ld]"
}

destroot.args       PREFIX=${prefix}

post-destroot {
    set docdir ${prefix}/share/doc/${subport}
    xinstall -d ${destroot}${docdir}
    xinstall -m 0644 -W ${worksrcpath} AUTHORS COPYING ChangeLog README \
        ${destroot}${docdir}
}

variant debug description {Enable debugging code} {
    configure.cxxflags-append -DPBZIP_DEBUG
}

livecheck.type      regex
livecheck.url       https://launchpad.net/pbzip2
livecheck.regex     {pbzip2-(\d+(?:\.\d+)*).tar.gz}
