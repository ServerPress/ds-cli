# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 137126 2015-06-05 02:17:56Z khindenburg@macports.org $

PortSystem          1.0
PortGroup           perl5 1.0
PortGroup           github 1.0

# Need to use perl 5.16 because p5.12-wx does not work. But make the perl version easy to change.
set perl-version    5.16
perl5.branches      ${perl-version}

github.setup        bruceravel demeter 0.9.21

conflicts           demeter-devel

categories          science
platforms           darwin
license             Permissive
maintainers         nist.gov:joe.fowler openmaintainer

description         Demeter is a comprehensive system for processing and analyzing X-ray Absorption Spectroscopy data.

long_description    Demeter is a comprehensive system for processing and analyzing X-ray Absorption Spectroscopy data.

homepage            http://bruceravel.github.com/demeter/

checksums           rmd160  77d3b755fe84ae9a0e478da3a0d4ca0e638b5edb \
                    sha256  a78ce0a6f10106875ba718ed10cc29601c7fb9342032924540e8b29f07348ea3

depends_build-append \
                    port:p${perl-version}-file-touch \
                    port:p${perl-version}-image-size \
                    port:p${perl-version}-pod-projectdocs \
                    port:p${perl-version}-ppi \
                    port:p${perl-version}-ppi-html \
                    port:p${perl-version}-syntax-highlight-perl \
                    port:p${perl-version}-template-toolkit

depends_lib-append  port:ifeffit \
                    port:p${perl-version}-archive-zip \
                    port:p${perl-version}-capture-tiny \
                    port:p${perl-version}-chemistry-elements \
                    port:p${perl-version}-config-ini \
                    port:p${perl-version}-const-fast \
                    port:p${perl-version}-datetime \
                    port:p${perl-version}-encoding-fixlatin \
                    port:p${perl-version}-file-copy-recursive \
                    port:p${perl-version}-file-countlines \
                    port:p${perl-version}-file-monitor-lite \
                    port:p${perl-version}-graph \
                    port:p${perl-version}-graphics-gnuplotif \
                    port:p${perl-version}-html-parser \
                    port:p${perl-version}-ifeffit \
                    port:p${perl-version}-math-combinatorics \
                    port:p${perl-version}-math-derivative \
                    port:p${perl-version}-math-random \
                    port:p${perl-version}-math-spline \
                    port:p${perl-version}-moose \
                    port:p${perl-version}-moosex-aliases \
                    port:p${perl-version}-moosex-singleton \
                    port:p${perl-version}-moosex-strictconstructor \
                    port:p${perl-version}-moosex-types \
                    port:p${perl-version}-moosex-types-laxnum \
                    port:p${perl-version}-pdl \
                    port:p${perl-version}-pdl-stats \
                    port:p${perl-version}-pod-pom \
                    port:p${perl-version}-ppi \
                    port:p${perl-version}-regexp-assemble \
                    port:p${perl-version}-regexp-common \
                    port:p${perl-version}-soap-lite \
                    port:p${perl-version}-spreadsheet-writeexcel \
                    port:p${perl-version}-statistics-descriptive \
                    port:p${perl-version}-string-random \
                    port:p${perl-version}-term-sk \
                    port:p${perl-version}-term-twiddle \
                    port:p${perl-version}-text-template \
                    port:p${perl-version}-tree-simple \
                    port:p${perl-version}-want \
                    port:p${perl-version}-wx \
                    port:p${perl-version}-yaml-tiny \
                    port:perl${perl-version}

patchfiles          patch-DocBuilder-Artemis.pm.diff \
                    patch-DocBuilder-Athena.pm.diff

post-patch {
    reinplace "s|@@PERL-VERSION@@|${perl-version}|g" ${worksrcpath}/DocBuilder/Artemis.pm
    reinplace "s|@@PERL-VERSION@@|${perl-version}|g" ${worksrcpath}/DocBuilder/Athena.pm

    # File::Find can't handle recursive links - t@ -> .
    file delete ${worksrcpath}/t/t
}

configure.cmd       ${prefix}/bin/perl${perl-version} Build.PL
configure.args      --destdir ${destroot}

build.cmd           ./Build
build.target        install

post-destroot   {
    # Put the main executables (perl scripts) into the PATH
    ln -s ${prefix}/libexec/perl${perl-version}/sitebin/dartemis    ${destroot}${prefix}/bin/artemis
    ln -s ${prefix}/libexec/perl${perl-version}/sitebin/dathena     ${destroot}${prefix}/bin/athena
    ln -s ${prefix}/libexec/perl${perl-version}/sitebin/atoms-gui   ${destroot}${prefix}/bin/atoms
    ln -s ${prefix}/libexec/perl${perl-version}/sitebin/datoms      ${destroot}${prefix}/bin/datoms
    ln -s ${prefix}/libexec/perl${perl-version}/sitebin/dhephaestus ${destroot}${prefix}/bin/hephaestus
}

# Yes, -devel is currently the same as standard demeter, because the
# latest tagged release is the stable one. (3 Feb 2015)
subport demeter-devel {
    github.setup        bruceravel demeter 0.9.20
    epoch               2

    conflicts           demeter

    checksums           rmd160  b1223bc5641da5c5d717837004e206b59eb45cf7 \
                        sha256  c3104816f8d81ce2ae9abeae6df269819b62362a2058abca49fb6132ffbe19f0

    depends_lib-append  port:p${perl-version}-encoding-fixlatin-xs \
                        port:p${perl-version}-math-random
}
