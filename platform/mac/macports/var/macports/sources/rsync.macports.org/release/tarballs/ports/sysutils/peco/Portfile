# $Id: Portfile 134391 2015-03-24 13:35:11Z kimuraw@macports.org $

PortSystem      1.0
PortGroup       github 1.0

github.setup    peco peco 0.3.2 v
revision        0
categories      sysutils
homepage        http://peco.github.io
description     Simplistic interactive filtering tool
long_description \
        peco can be a great tool to filter stuff like logs, process stats, find \
        files, because unlike grep, you can type as you think and look through  \
        the current results.
license         MIT

maintainers     kimuraw openmaintainer
platforms       darwin

depends_build   port:go
use_configure   no
dist_subdir     go

# peco
checksums       peco-${version}.tar.gz \
                    md5 76f4b75ab75a79abc279c88c6804d97a \
                    sha1 b780702b95feaed2bd3a8921790f79ae61e09dcc \
                    sha256 62260730d9ebeaecc404990e518b8ec1b7c1294e0f52a07cf4838ae374b4e162

# dependencies to build. remember revbump when you change version of dependencies.
set go-flags.version        1
set go-runewidth.version    58a0da4ed7b321c9b5dfeffb7e03ee188fae1c60
set termbox-go.version      10f14d7408b64a659b7c694a771f5006952d336c
set google-btree.version    0c05920fc3d98100a5e3f7fd339865a6e2aaa671
# dependencies
master_sites-append https://github.com/jessevdk/go-flags/tarball/v${go-flags.version}:go-flags \
                    https://github.com/mattn/go-runewidth/tarball/${go-runewidth.version}:go-runewidth \
                    https://github.com/nsf/termbox-go/tarball/${termbox-go.version}:termbox-go \
                    https://github.com/google/btree/tarball/${google-btree.version}:google-btree
distfiles-append    jessevdk-go-flags-v${go-flags.version}.tar.gz:go-flags \
                    mattn-go-runewidth-${go-runewidth.version}.tar.gz:go-runewidth \
                    nsf-termbox-go-${termbox-go.version}.tar.gz:termbox-go \
                    google-btree-${google-btree.version}.tar.gz:google-btree
checksums-append    jessevdk-go-flags-v${go-flags.version}.tar.gz \
                        md5 33244c6469610036f0c38b8c772f7533 \
                        sha1 0a0878b70fa263efc3fcb330c999138772a43893 \
                        sha256 e384b7a12c91ad9202e208665cc51c5fbdf1eb21711fd9fce67426abc5adb58f \
                    mattn-go-runewidth-${go-runewidth.version}.tar.gz \
                        md5 835771e811a6f078e498a6313067ee79 \
                        sha1 c58bb8ae8c5ecbda91727896bcda8212bfbbc2a5 \
                        sha256 4fb1177054345594aa065ade91a54eb216cefefcec016854bc799c4d0093f48b \
                    nsf-termbox-go-${termbox-go.version}.tar.gz \
                        md5 730899562e8c5c5315e13f4e789a542d \
                        sha1 ad5848e9b255916ebc3e9702bdcfe7cc071172f3 \
                        sha256 0d5a02a953f085824f014143b063d44885777e580c7002adc39b06ef3069c3f4 \
                    google-btree-${google-btree.version}.tar.gz \
                        md5 3c20d1ca9728edd0777faf1941022d33 \
                        sha1 27ae29bfe84f4dc714f7a3f7cf53d6082b97a1f0 \
                        sha256 42ea86dba6bcbc055af6cdfbcfc6303695d2c9d70cf4bb882a27d55aab945d16
# setup build sources like this:
#   workpath/
#       peco-0.1.12/
#       gopath/src/github.com/
#           peco/peco/
#           jessevdk/go-flags-v/
#             :
set gopath      ${workpath}/GOPATH
post-extract {
    file mkdir ${gopath}/src/github.com/peco
    ln -s ${worksrcpath} ${gopath}/src/github.com/peco/peco
    file mkdir ${gopath}/src/github.com/jessevdk
    move [glob ${workpath}/jessevdk-go-flags-*] ${gopath}/src/github.com/jessevdk/go-flags
    file mkdir ${gopath}/src/github.com/mattn
    move [glob ${workpath}/mattn-go-runewidth-*] ${gopath}/src/github.com/mattn/go-runewidth
    file mkdir ${gopath}/src/github.com/nsf
    move [glob ${workpath}/nsf-termbox-go-*] ${gopath}/src/github.com/nsf/termbox-go
    file mkdir ${gopath}/src/github.com/google
    move [glob ${workpath}/google-btree-*] ${gopath}/src/github.com/google/btree
}

build.cmd       go
build.target    build
build.args      cmd/peco/peco.go
build.env       GOPATH="${gopath}"

destroot {
    xinstall ${worksrcpath}/peco ${destroot}${prefix}/bin
}
