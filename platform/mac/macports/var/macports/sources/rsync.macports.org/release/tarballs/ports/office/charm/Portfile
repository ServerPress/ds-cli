# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 135574 2015-04-26 18:30:38Z mk@macports.org $

PortSystem          1.0
PortGroup           github 1.0
PortGroup           cmake 1.0

github.setup        KDAB Charm 1.9.0rc1

name                charm
maintainers         gmail.com:rjvbertin mk openmaintainer
categories          office
license             GPL-2+ LGPL-2.1+
description         Charm - the Cross-Platform Time Tracker
long_description    Charm is a program for OS X, Linux and Windows that helps to keep track of time. It is built around two major ideas - tasks and events. Tasks are the things time is spend on, repeatedly. For example, ironing laundry is a task. The laundry done for two hours on last Tuesday is an event in that task. When doing laundry multiple times, the events will be accumulated, and can later be printed in activity reports or weekly/monthly time sheets. So in case laundry would be done for three hours on Wednesday again, the activity report for the "Ironing Laundry" task would list the event on tuesday, the event on wednesday and a total of five hours.
platforms           darwin

subport ${name}-qt5 {
    PortGroup       qt5 1.0

    conflicts       ${name}
    depends_lib-append      port:qt5-mac-sqlite3-plugin
    configure.args-append   -DWITH_QT4:BOOL=OFF

    checksums       rmd160  1ef90f8273eab79f1b0ee067021f1548bf945971 \
                    sha256  32da61e2d13f0b2ce1b46f2ee7bbdff94a4d78cb4fe0b43fee16e857fb810ac1
}

if {${subport} ne "${name}-qt5"} {
    PortGroup       qt4 1.0

    version         1.8.0
    revision        20150312

    conflicts       ${name}-qt5
    depends_build-append    port:automoc
    depends_lib-append      port:qt4-mac-sqlite3-plugin
    configure.args-append   -DWITH_QT4:BOOL=ON

    # faaf49e9
    checksums       rmd160  50e87a81e853c81ea0d538f7a165570d0e9f2ac0 \
                    sha256  f49b485e0bd072f3564420859d0114538a3d321cd2f9c1a124d488aefbea8424
}

#configure.args-append   -DCharm_VERSION="${version}-${github.version}" -DBIN_INSTALL_DIR:PATH=${qt_apps_dir}
configure.args-append   -DCharm_VERSION="${version}" -DBIN_INSTALL_DIR:PATH=${qt_apps_dir}

patchfiles          patch-CMakeFiles.patch \
                    adapt-to-osx-macports.patch

post-extract                {file mkdir ${workpath}/build}
# standard post-arg, where to find the primary CMakeLists.txt file.
default configure.post_args {../${worksrcdir}}
default configure.dir       {${workpath}/build}
default build.dir           {${workpath}/build}

use_parallel_build  yes

post-destroot {
    xinstall -m 0755 -d ${destroot}${qt_apps_dir}
    ln -s ${qt_apps_dir}/Charm.app/Contents/MacOS/Charm ${destroot}${prefix}/bin/charmtimetracker
}

