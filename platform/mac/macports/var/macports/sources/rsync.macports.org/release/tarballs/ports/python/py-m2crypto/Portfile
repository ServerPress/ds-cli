# $Id: Portfile 143263 2015-12-09 16:28:06Z jmr@macports.org $

PortSystem         1.0
PortGroup          python 1.0

name               py-m2crypto
version            0.22.5
categories-append  crypto devel
# demos include some Apache-2 and ZPL-2 files but are not installed
license            MIT
maintainers        nomaintainer
description        M2Crypto is a crypto and SSL toolkit for Python.
long_description   ${description}

platforms          darwin

homepage           https://pypi.python.org/pypi/M2Crypto
master_sites       https://pypi.python.org/packages/source/M/M2Crypto/
distname           M2Crypto-${version}

python.versions    26 27

checksums          md5 f84eb07aa1687f39bc26ee7b1ba5a105 \
                   rmd160 5b2518880e166020a2aa425a198c7b67dc75c49b \
                   sha256 b5ce9b09062a2c453e9d9c28dde96b7f90834313e60f419b143d751eb4109fdc

if {${name} ne ${subport}} {
  depends_build      port:py${python.version}-setuptools
  depends_lib-append port:swig-python \
                     path:lib/libssl.dylib:openssl

  post-patch {
    reinplace "s|#extra_link_args|extra_link_args|g" ${worksrcpath}/setup.py
    reinplace "s|self.openssl = '/usr'|self.openssl = '${prefix}'|g" \
      ${worksrcpath}/setup.py
  }
}

if {${name} eq ${subport}} {
  livecheck.type     regex
  livecheck.url      ${homepage}
  livecheck.regex    M2Crypto-(\[0-9\\.\]+)\.tar\.gz
} else {
  livecheck.type     none
}
