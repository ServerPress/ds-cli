--- operations/workshop/external/ff-save.c.orig	2014-07-18 03:23:57.000000000 -0700
+++ operations/workshop/external/ff-save.c	2014-07-20 10:47:31.000000000 -0700
@@ -573,7 +573,7 @@
     }
 
   /* open the codec */
-  if (avcodec_open (c, codec) < 0)
+  if (avcodec_open2 (c, codec, NULL) < 0)
     {
       fprintf (stderr, "could not open codec\n");
       exit (1);
@@ -774,26 +774,24 @@
      /*XXX: FOO p->audio_st = add_audio_stream (op, p->oc, p->fmt->audio_codec);*/
     }
 
-  if (av_set_parameters (p->oc, NULL) < 0)
-    {
-      fprintf (stderr, "Invalid output format propeters\n%s", "");
-      return -1;
-    }
-
-  dump_format (p->oc, 0, self->path, 1);
+  av_dump_format (p->oc, 0, self->path, 1);
 
   if (p->video_st)
     open_video (p, p->oc, p->video_st);
   if (p->audio_st)
     open_audio (p, p->oc, p->audio_st);
 
-  if (url_fopen (&p->oc->pb, self->path, URL_WRONLY) < 0)
+  if (avio_open (&p->oc->pb, self->path, AVIO_FLAG_WRITE) < 0)
     {
       fprintf (stderr, "couldn't open '%s'\n", self->path);
       return -1;
     }
 
-  av_write_header (p->oc);
+  if (avformat_write_header (p->oc, NULL) < 0)
+     {
+        fprintf(stderr, "Error occurred when opening output file\n");
+        return 1;
+     }
 
   return 0;
 }
@@ -863,7 +861,7 @@
             av_freep (&p->oc->streams[i]);
           }
 
-        url_fclose (&p->oc->pb);
+        avio_close (p->oc->pb);
         free (p->oc);
       }
       g_free (o->user_data);
--- operations/workshop/external/ff-save.c.orig	2014-09-18 13:10:57.000000000 -0700
+++ operations/workshop/external/ff-save.c	2014-09-18 13:10:57.000000000 -0700
@@ -363,7 +363,7 @@
   AVStream *st;
 
   p = NULL;
-  st = av_new_stream (oc, 1);
+  st = avformat_new_stream (oc, 1);
   if (!st)
     {
       fprintf (stderr, "Could not alloc stream\n");
@@ -492,7 +492,7 @@
   AVCodecContext *c;
   AVStream *st;
 
-  st = av_new_stream (oc, 0);
+  st = avformat_new_stream (oc, 0);
   if (!st)
     {
       fprintf (stderr, "Could not alloc stream %p %p %i\n", op, oc, codec_id);
