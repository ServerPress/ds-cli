--- modules/ffmpeg_in/ffmpeg_demux.c.orig	2014-09-17 11:11:54.000000000 -0700
+++ modules/ffmpeg_in/ffmpeg_demux.c	2014-09-17 11:14:34.000000000 -0700
@@ -54,7 +54,9 @@
 
 #if (LIBAVFORMAT_VERSION_MAJOR > 54) || ((LIBAVFORMAT_VERSION_MAJOR == 54) && (LIBAVFORMAT_VERSION_MINOR >= 20))
 #define av_find_stream_info(__c)        avformat_find_stream_info(__c, NULL)
-#define FF_API_FORMAT_PARAMETERS        1
+#ifndef FF_API_FORMAT_PARAMETERS
+#define FF_API_FORMAT_PARAMETERS        (LIBAVFORMAT_VERSION_MAJOR < 56)
+#endif
 #endif
 
 
@@ -346,7 +348,7 @@
 	}
 
 exit:
-    if (ctx) av_close_input_file(ctx);
+    if (ctx) avformat_close_input(&ctx);
 	return ret;
 }
 
@@ -705,7 +707,7 @@
 
 		ffd->seekable = (av_seek_frame(ffd->ctx, -1, 0, AVSEEK_FLAG_BACKWARD)<0) ? 0 : 1;
 		if (!ffd->seekable) {
-			av_close_input_file(ffd->ctx);
+			avformat_close_input(&(ffd->ctx));
 			open_file(&ffd->ctx, szName, av_in);
 			av_find_stream_info(ffd->ctx);
 		}
@@ -719,7 +721,7 @@
 
 err_exit:
 	GF_LOG(GF_LOG_ERROR, GF_LOG_CONTAINER, ("[FFMPEG] Error opening file %s: %s\n", url, gf_error_to_string(e)));
-    if (ffd->ctx) av_close_input_file(ffd->ctx);
+    if (ffd->ctx) avformat_close_input(&(ffd->ctx));
 	ffd->ctx = NULL;
 	gf_term_on_connect(serv, NULL, e);
 	return GF_OK;
@@ -773,7 +775,7 @@
 
 	ffd->is_running = 0;
 
-	if (ffd->ctx) av_close_input_file(ffd->ctx);
+	if (ffd->ctx) avformat_close_input(&(ffd->ctx));
 	ffd->ctx = NULL;
 	ffd->audio_ch = ffd->video_ch = NULL;
 	ffd->audio_run = ffd->video_run = 0;
--- modules/ffmpeg_in/ffmpeg_demux.c.orig	2014-09-17 11:20:35.000000000 -0700
+++ modules/ffmpeg_in/ffmpeg_demux.c	2014-09-17 11:21:52.000000000 -0700
@@ -624,11 +624,7 @@
 			}
 			/*setup downloader*/
 			av_in->flags |= AVFMT_NOFILE;
-#if FF_API_FORMAT_PARAMETERS /*commit ffmpeg 603b8bc2a109978c8499b06d2556f1433306eca7*/
 			res = avformat_open_input(&ffd->ctx, szName, av_in, NULL);
-#else
-			res = av_open_input_stream(&ffd->ctx, &ffd->io, szName, av_in, NULL);
-#endif
 		}
 	} else {
 		res = open_file(&ffd->ctx, szName, av_in);
