# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 139316 2015-08-12 17:04:20Z devans@macports.org $

PortSystem          1.0
PortGroup           github 1.0

github.setup        newville ifeffit 1.2.13
revision            4
categories          science
platforms           darwin
license             Permissive
maintainers         nist.gov:joe.fowler openmaintainer

description         IFEFFIT is a program and programming library for analyzing x-ray absorption fine-structure (XAFS) data.

long_description    IFEFFIT is a program and programming library for analyzing x-ray absorption fine-structure (XAFS) data. \
                    As its name may suggest, IFEFFIT1 gives an interactive method for fitting XAFS data using calculations \
                    from FEFF, and is based on the fitting program FEFFIT of the UWXAFS3.0 Analysis Package.

homepage            http://cars.uchicago.edu/~ifeffit/

checksums           rmd160  7b09aa5722a4aa638364c35e15d64b857cdb822b \
                    sha256  79fa938643a1417c5b01be4b6196bd0ea6bf40685448ba98546c7989b0f48a48

depends_lib         port:pgplot \
                    port:libpng \
                    port:xorg-libX11

# the ifeffit script to determine pgplot's linking options is broken
# so we have to supply them explicitly

configure.args      --with-pgplot \
                    --with-pgplot-link="-L${prefix}/lib -lpgplot -lpng -lX11"

# IMPORTANT BUILD NOTES
#
# ifeffit, pgplot and p5-ifeffit need to be using the same compiler libraries.
# therefore they must be built with the same gcc compiler variants.
# currently this is gcc49 by default but it you change one change them all and rebuild.
#
# p5-ifeffit is configured using a Makefile.PL that is generated when ifeffit is built.
# since the paths to the compiler libraries contain compiler version information,
# if the compiler version changes then both ifeffit and p5-ifeffit need to be rebuilt
# so that the Makefile.PL in use contains the correct paths.
#
# if in doubt rebuild everything

variant gcc45 description {Use gfortran from gcc45} conflicts gcc46 gcc47 gcc48 gcc49 {
    depends_lib-append    port:gcc45
    configure.fc          ${prefix}/bin/gfortran-mp-4.5
    configure.f77         ${prefix}/bin/gfortran-mp-4.5
    configure.f90         ${prefix}/bin/gfortran-mp-4.5
    configure.args-append --with-fortran=${prefix}/bin/gfortran-mp-4.5
}

variant gcc46 description {Use gfortran from gcc46} conflicts gcc45 gcc47 gcc48 gcc49 {
    depends_lib-append    port:gcc46
    configure.fc          ${prefix}/bin/gfortran-mp-4.6
    configure.f77         ${prefix}/bin/gfortran-mp-4.6
    configure.f90         ${prefix}/bin/gfortran-mp-4.6
    configure.args-append --with-fortran=${prefix}/bin/gfortran-mp-4.6
}

variant gcc47 description {Use gfortran from gcc47} conflicts gcc45 gcc46 gcc48 gcc49 {
    depends_lib-append    port:gcc47
    configure.fc          ${prefix}/bin/gfortran-mp-4.7
    configure.f77         ${prefix}/bin/gfortran-mp-4.7
    configure.f90         ${prefix}/bin/gfortran-mp-4.7
    configure.args-append --with-fortran=${prefix}/bin/gfortran-mp-4.7
}

variant gcc48 description {Use gfortran from gcc48} conflicts gcc45 gcc46 gcc47 gcc49 {
    depends_lib-append    port:gcc48
    configure.fc          ${prefix}/bin/gfortran-mp-4.8
    configure.f77         ${prefix}/bin/gfortran-mp-4.8
    configure.f90         ${prefix}/bin/gfortran-mp-4.8
    configure.args-append --with-fortran=${prefix}/bin/gfortran-mp-4.8
}

variant gcc49 description {Use gfortran from gcc49} conflicts gcc45 gcc46 gcc47 gcc48 {
    depends_lib-append    port:gcc49
    configure.fc          ${prefix}/bin/gfortran-mp-4.9
    configure.f77         ${prefix}/bin/gfortran-mp-4.9
    configure.f90         ${prefix}/bin/gfortran-mp-4.9
    configure.args-append --with-fortran=${prefix}/bin/gfortran-mp-4.9
}

if {![variant_isset gcc45] && ![variant_isset gcc46] && ![variant_isset gcc47] && ![variant_isset gcc48]} {
    default_variants    +gcc49
}

# this is the final release of ifeffit
livecheck.type none
