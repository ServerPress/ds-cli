# $Id: Portfile 129772 2014-12-20 07:03:34Z jmr@macports.org $

PortSystem  1.0

name		clearsilver
version     	0.10.5
revision	2
categories	www python perl
platforms	darwin
maintainers	nomaintainer
description 	Language-neutral template system.
long_description	Clearsilver is a fast, powerful, and language-neutral \
			HTML template system. In both  static content sites \
			and dynamic  HTML applications, it provides a \
			separation between  presentation code and application \
			logic which makes  working with your project easier.

homepage	http://www.clearsilver.net
master_sites	${homepage}/downloads

checksums       md5 b8c0c7fbe0ef5e06e0c935f134304d44 \
                sha1 138865dc91e27328fe29fcaaac1bc6558f19dd75 \
                rmd160 bd5c616f326b544df8a74eec71a98a474b408249

patchfiles	patch-rules.mk.in.diff \
            patch-cgi__cgi.c \
            patch-cgi__html.c \
            patch-cgi__rfc2388.c \
            patch-cs__csparse.c \
            patch-cs__cstest.c \
            patch-util__dict.c \
            patch-util__neo_files.c \
            patch-util__neo_hash.c \
            patch-util__neo_hdf.c \
            patch-util__neo_net.c \
            patch-util__neo_server.c \
            patch-util__neo_str.c \
            patch-util__skiplist.c \
            patch-util__ulist.c \
            patch-util__ulocks.c

depends_lib	port:python27 port:perl5.16 port:zlib port:gettext

set python_bin  ${prefix}/bin/python2.7

configure.args	--disable-apache --disable-java --disable-ruby \
		--disable-csharp \
		--with-python=${python_bin} \
		--with-perl=${prefix}/bin/perl5.16 \
		--enable-gettext \
		--mandir=${prefix}/share/man

pre-configure	{
	set PYTHON_PATH ${frameworks_dir}/Python.framework/Versions/2.7/lib/python2.7

	reinplace "s|PYTHON_SITE=`.*|PYTHON_SITE=${PYTHON_PATH}/site-packages|g" \
		${worksrcpath}/configure

	reinplace "s|/usr/local/bin/python|${python_bin}|g" \
		${worksrcpath}/scripts/document.py
	reinplace "s|/usr/bin/python|${python_bin}|g" \
		${worksrcpath}/scripts/cs_lint.py \
		${worksrcpath}/scripts/commitlog.py
	reinplace "s|/neo/opt/bin/python|${python_bin}|g" \
		${worksrcpath}/scripts/ChangeLog.py

	reinplace "s|\$(PERL) Makefile.PL|\$(PERL) Makefile.PL installdirs=vendor|g" \
		${worksrcpath}/Makefile
}

post-configure {
	reinplace "s|#include <features.h>||g" \
                ${worksrcpath}/cgi/cgiwrap.c
}

## stolen from perl5 group code
post-destroot {
                foreach packlist [exec find ${destroot} -name .packlist] {
                        ui_info "Fixing packlist ${packlist}"
                        reinplace "s|${destroot}||" ${packlist}
                }
		foreach badfile [exec find ${destroot} -name perllocal.pod] {
			ui_info "Removing ${badfile}"
			file delete ${badfile}
		}
        }

livecheck.type  regex
livecheck.url   ${homepage}/downloads
livecheck.regex {clearsilver-([0-9.]+)\.tar\.gz}
