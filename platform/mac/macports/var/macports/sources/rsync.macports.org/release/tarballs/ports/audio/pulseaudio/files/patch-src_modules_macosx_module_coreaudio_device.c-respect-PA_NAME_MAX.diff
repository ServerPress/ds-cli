--- src/modules/macosx/module-coreaudio-device.c.old	2015-04-20 01:41:14.000000000 +0200
+++ src/modules/macosx/module-coreaudio-device.c	2015-04-20 01:43:58.000000000 +0200
@@ -43,6 +43,7 @@
 #include <pulsecore/thread.h>
 #include <pulsecore/thread-mq.h>
 #include <pulsecore/i18n.h>
+#include <pulsecore/namereg.h>
 
 #include <CoreAudio/CoreAudio.h>
 #include <CoreAudio/CoreAudioTypes.h>
@@ -416,7 +417,7 @@ static int ca_device_create_sink(pa_modu
     coreaudio_sink *ca_sink;
     pa_sink *sink;
     unsigned int i, channels;
-    char tmp[255];
+    char tmp[255], *tmp_clamp;
     pa_strbuf *strbuf;
     AudioObjectPropertyAddress property_address;
     CFStringRef tmp_cfstr;
@@ -455,7 +456,14 @@ static int ca_device_create_sink(pa_modu
         pa_strbuf_puts(strbuf, tmp);
     }
 
-    ca_sink->name = pa_strbuf_tostring_free(strbuf);
+    /* Clamp to PA_NAME_MAX and leave a "safety margin" for deduplication
+     * and other appended data. */
+    tmp_clamp = pa_strbuf_tostring_free(strbuf);
+    strncpy(tmp, tmp_clamp, PA_NAME_MAX - 20);
+    tmp[PA_NAME_MAX - 20] = 0;
+    pa_xfree(tmp_clamp);
+
+    ca_sink->name = pa_xstrndup(tmp, PA_NAME_MAX);
 
     pa_log_debug("Stream name is >%s<", ca_sink->name);
 
@@ -546,7 +554,7 @@ static int ca_device_create_source(pa_mo
     coreaudio_source *ca_source;
     pa_source *source;
     unsigned int i, channels;
-    char tmp[255];
+    char tmp[255], *tmp_clamp;
     pa_strbuf *strbuf;
     AudioObjectPropertyAddress property_address;
     CFStringRef tmp_cfstr;
@@ -585,7 +593,14 @@ static int ca_device_create_source(pa_mo
         pa_strbuf_puts(strbuf, tmp);
     }
 
-    ca_source->name = pa_strbuf_tostring_free(strbuf);
+    /* Clamp to PA_NAME_MAX and leave a "safety margin" for deduplication
+     * and other appended data. */
+    tmp_clamp = pa_strbuf_tostring_free(strbuf);
+    strncpy(tmp, tmp_clamp, PA_NAME_MAX - 20);
+    tmp[PA_NAME_MAX - 20] = 0;
+    pa_xfree(tmp_clamp);
+
+    ca_source->name = pa_xstrndup(tmp, PA_NAME_MAX);
 
     pa_log_debug("Stream name is >%s<", ca_source->name);
 
