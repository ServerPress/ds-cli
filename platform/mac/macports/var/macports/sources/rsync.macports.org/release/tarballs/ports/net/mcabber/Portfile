# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 122118 2014-07-15 00:46:47Z ryandesign@macports.org $

PortSystem          1.0

name                mcabber
version             0.10.3
license             GPL-2+
categories          net
maintainers         nomaintainer
description         Console Jabber client
long_description    mcabber is a small Jabber console client. It includes features like \
                    SSL, MUC, history logging, command completion, OpenPGP encryption, \
                    OTR and external action triggers.
homepage            http://mcabber.com/
platforms           darwin
master_sites        http://mcabber.com/files/
use_bzip2           yes
checksums           rmd160  d94e7b2e340cfd83a5b55276cdb0383a8555b347 \
                    sha256  77466138496cc26db125145cc28dc4fc0df79827143b922dfb9f02eb0dc7fa6d

depends_lib         port:libiconv \
                    port:ncurses \
                    path:lib/pkgconfig/glib-2.0.pc:glib2 \
                    port:gettext \
                    port:libotr \
                    port:gpgme \
                    port:libgcrypt \
                    port:loudmouth

depends_build       port:autoconf \
                    port:automake \
                    port:coreutils \
                    bin:gawk:gawk \
                    port:libtool \
                    port:pkgconfig \
                    port:cctools \
                    port:grep \
                    port:gsed

configure.args      --enable-otr \
                    --with-libotr-prefix=${prefix}/lib \
                    --with-libotr-inc-prefix=${prefix}/include

configure.env       LIBTOOL=glibtool

patchfiles          patch-autogen.sh.diff

pre-configure {
    system -W ${worksrcpath} "./autogen.sh"
}

# TODO
# Bug #26 on mcabber - see pre-configure section for a workaround
variant aspell description {Use aspell spell checking - remember to install a dictionary, too} {
    configure.args-append   --enable-aspell
    depends_lib-append      port:aspell
}

post-configure {
    reinplace "s|#define HAVE_LOCALCHARSET_H 1|\/\* #undef HAVE_LOCALCHARSET_H \*\/|g" ${worksrcpath}/${name}/config.h
}

livecheck.type      regex
livecheck.url       ${homepage}
livecheck.regex     {<tt>mcabber ([0-9.]*)</tt>}
