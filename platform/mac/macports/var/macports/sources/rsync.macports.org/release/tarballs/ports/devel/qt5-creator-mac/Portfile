# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 137792 2015-06-19 19:51:45Z mcalhoun@macports.org $

PortSystem          1.0

name                qt5-creator-mac

if { ${subport} eq "${name}-docs" || ${subport} eq "${name}-examples" } {
    universal_variant no
    supported_archs   noarch
}
PortGroup           qmake5 1.0

version             3.4.1
categories          devel aqua
platforms           darwin
license             LGPL-2.1
maintainers         mcalhoun openmaintainer
description         Cross-platform integrated development environment (IDE) tailored to the needs of Qt developers.
long_description    Qt Creator is a cross-platform integrated development environment (IDE) tailored to the needs of Qt developers.

homepage            http://qt-project.org/wiki/Category:Tools::QtCreator
distname            qt-creator-opensource-src-${version}
master_sites        https://download.qt-project.org/official_releases/qtcreator/[join [lrange [split ${version} .] 0 1] .]/${version}/

checksums           rmd160  e4fc59e156514e6c29697c414c655efdc410e337 \
                    sha256  029e22307e79c4fb3a34be854dedddaa56476c6c6374c312125b9302bcbc0fd9

if { ${subport} eq ${name}  } {
    depends_lib-append     port:botan
    configure.args-append  "USE_SYSTEM_BOTAN=1"
        
    if { ![variant_isset universal] } {
        destroot {
            # make install attempts to install command line tools into /bin, etc.
            xinstall -m 755 -d ${destroot}${qt_apps_dir}
            copy "${worksrcpath}/bin/Qt Creator.app" "${destroot}${qt_apps_dir}"
        }
    } else {
        # We should really just override destroot, but the muniversal Portgroup would override our override.
        destroot.cmd "true"
        merger-post-destroot {
            foreach arch ${universal_archs_to_use} {
                xinstall -m 755 -d ${destroot}-${arch}${qt_apps_dir}
                copy "${worksrcpath}-${arch}/bin/Qt Creator.app" "${destroot}-${arch}${qt_apps_dir}"
            }
        }
    }
}

subport ${name}-docs {
    depends_lib-append port:${name} port:qt5-mac-sqlite3-plugin 
    build.target       docs
    
    destroot {
        delete "${worksrcpath}/bin/Qt Creator.app/Contents/Info.plist"
        delete "${worksrcpath}/bin/Qt Creator.app/Contents/MacOS/qml2puppet.app/Contents/Info.plist"
        delete "${worksrcpath}/bin/Qt Creator.app/Contents/MacOS/qmlpuppet.app/Contents/Info.plist"
        delete "${worksrcpath}/bin/Qt Creator.app/Contents/Resources/qml/qmldump/Info.plist"
        
        xinstall -m 755 -d ${destroot}${qt_apps_dir}
        copy "${worksrcpath}/bin/Qt Creator.app" "${destroot}${qt_apps_dir}"
        
        xinstall -m 755 -d ${destroot}${qt_docs_dir}
        copy ${worksrcpath}/doc/html ${worksrcpath}/doc/html-dev ${destroot}${qt_docs_dir}
    }
}

subport ${name}-examples {
    depends_lib-append port:${name}
    build           {}
    destroot.dir    ${worksrcpath}/src/shared/qbs
    destroot.target -f Makefile.static INSTALL_ROOT=${destroot}${prefix} install_examples
}

livecheck.type      regex
livecheck.url       http://www.qt.io/download-open-source/
livecheck.regex     qt-creator-opensource-src-(\[a-z0-9.\]+)${extract.suffix}"
